plugins {
    id 'java'
}

group = 'com.haneul.qa'
version = '1.0-SNAPSHOT'

repositories {
    mavenCentral()
}

dependencies {
    testImplementation platform('org.junit:junit-bom:5.10.0')
    testImplementation 'org.junit.jupiter:junit-jupiter'
    testImplementation 'org.seleniumhq.selenium:selenium-java:4.27.0'
    testImplementation 'org.assertj:assertj-core:3.26.3'

    testImplementation "io.qameta.allure:allure-junit5:2.27.0"
    testImplementation "io.qameta.allure:allure-assertj:2.27.0"

    testRuntimeOnly "org.aspectj:aspectjweaver:1.9.22.1"
}

tasks.withType(JavaCompile) {
    options.encoding = "UTF-8"
}

test {
    useJUnitPlatform()

    systemProperty "file.encoding", "UTF-8"
    systemProperty "allure.results.directory", layout.buildDirectory.dir("allure-results").get().asFile.absolutePath

    doFirst {
        def aspectjWeaverJar = configurations.testRuntimeClasspath.find { it.name.contains("aspectjweaver") }
        if (aspectjWeaverJar == null) {
            throw new GradleException("aspectjweaver jar not found in testRuntimeClasspath")
        }
        jvmArgs "-javaagent:${aspectjWeaverJar.absolutePath}"
    }
}